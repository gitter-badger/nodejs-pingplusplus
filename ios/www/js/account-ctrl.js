// Generated by CoffeeScript 1.8.0
bumblebee.controller("MeCtrl", function($scope, $ionicModal, $http, $localstorage, $location) {
  return $scope.loginOut = function() {
    $localstorage.setObject('user', {});
    $scope.user = $localstorage.getObject('user', {});
    return $location.path("/login");
  };
});

bumblebee.controller("ChangePasswordCtrl", function($scope, $ionicNavBarDelegate, $http, $localstorage, $rootScope) {
  var user;
  $scope.formData = {};
  user = $localstorage.getObject('user', {});
  return $scope.submit = function() {
    $http.put(glo_domain + "users/password", {
      Id: user.id,
      oldPassword: $scope.formData.oldPassword,
      newPassword: $scope.formData.newPassword
    }).success(function(user) {
      $localstorage.setObject('user', user);
      $rootScope.$broadcast('logined');
      return $ionicNavBarDelegate.back();
    });
  };
});

bumblebee.controller("ChangeNickNameCtrl", function($scope, $ionicNavBarDelegate, $http, $localstorage, $rootScope) {
  var user;
  $scope.formData = {};
  user = $localstorage.getObject('user', {});
  return $scope.submit = function() {
    $http.put(glo_domain + "users/password", {
      Id: user.id,
      oldPassword: $scope.formData.oldPassword,
      newPassword: $scope.formData.newPassword
    }).success(function(user) {
      $localstorage.setObject('user', user);
      $rootScope.$broadcast('logined');
      return $ionicNavBarDelegate.back();
    });
  };
});

bumblebee.controller("ChangePhoneCtrl", function($scope, $ionicNavBarDelegate, $http, $localstorage, $rootScope) {
  var user;
  $scope.formData = {};
  user = $localstorage.getObject('user', {});
  return $scope.submit = function() {
    $http.put(glo_domain + "users/password", {
      Id: user.id,
      oldPassword: $scope.formData.oldPassword,
      newPassword: $scope.formData.newPassword
    }).success(function(user) {
      $localstorage.setObject('user', user);
      $rootScope.$broadcast('logined');
      return $ionicNavBarDelegate.back();
    });
  };
});

bumblebee.controller("LoginCtrl", function($scope, $location, $http, $localstorage, $rootScope) {
  $scope.loginData = {
    password: "z5656z",
    phone: "18551090081"
  };
  return $scope.login = function() {
    $http.post(glo_domain + "users/session", {
      Phone: $scope.loginData.phone,
      Password: $scope.loginData.password
    }).success(function(user) {
      $localstorage.setObject('user', user);
      $rootScope.$broadcast('logined');
      return $location.path("/app/home");
    });
  };
});

bumblebee.controller("RegisterCtrl", function($scope, $location, $http, $localstorage, $rootScope) {
  var registerUser;
  $scope.registerData = {};
  $scope.registerStep = 1;
  registerUser = {};
  $scope.registerPhone = function() {
    return $http.post(glo_domain + "users/phone", {
      Phone: $scope.registerData.phone,
      Password: $scope.registerData.password
    }).success(function(user) {
      registerUser = user;
      return AV.Cloud.requestSmsCode({
        mobilePhoneNumber: user.phone,
        name: '神猪的注册',
        op: '手机验证',
        ttl: 5
      }).then(function() {
        return $scope.$apply(function() {
          return $scope.registerStep = 2;
        });
      }, function(err) {
        return alert(err + '。请联系管理员');
      });
    });
  };
  $scope.registerSmsCode = function() {
    return AV.Cloud.verifySmsCode($scope.registerData.smscode).then(function() {
      return $scope.$apply(function() {
        return $scope.registerStep = 3;
      });
    }, function(err) {
      return alert("验证失败，请重试");
    });
  };
  return $scope.register = function() {
    return $http.post(glo_domain + "users/", {
      Id: registerUser.id,
      Nickname: $scope.registerData.nickname,
      Gender: $scope.registerData.gender
    }).success(function(user) {
      $localstorage.setObject('user', user);
      $rootScope.$broadcast('logined');
      return $location.path("/");
    });
  };
});

//# sourceMappingURL=account-ctrl.js.map
